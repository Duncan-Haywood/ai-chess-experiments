"""Initial migration

Revision ID: 39410eb01050
Revises: 
Create Date: 2025-02-22 16:40:39.836721

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '39410eb01050'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('games',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('white_model', sa.String(length=100), nullable=False),
    sa.Column('black_model', sa.String(length=100), nullable=False),
    sa.Column('pgn', sa.Text(), nullable=False),
    sa.Column('result', sa.Enum('WHITE_WIN', 'BLACK_WIN', 'DRAW', name='gameresult'), nullable=False),
    sa.Column('num_moves', sa.Integer(), nullable=False),
    sa.Column('timestamp', sa.DateTime(), nullable=False),
    sa.Column('termination_reason', sa.String(length=200), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_games_black_model', 'games', ['black_model'], unique=False)
    op.create_index('ix_games_timestamp', 'games', ['timestamp'], unique=False)
    op.create_index('ix_games_white_model', 'games', ['white_model'], unique=False)
    op.create_table('ratings',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('model_name', sa.String(length=100), nullable=False),
    sa.Column('rating', sa.Float(), nullable=False),
    sa.Column('rd', sa.Float(), nullable=False),
    sa.Column('vol', sa.Float(), nullable=False),
    sa.Column('num_games', sa.Integer(), nullable=False),
    sa.Column('last_updated', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('model_name')
    )
    op.create_index('ix_ratings_model_name', 'ratings', ['model_name'], unique=True)
    op.create_table('game_moves',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('game_id', sa.Integer(), nullable=False),
    sa.Column('move_number', sa.Integer(), nullable=False),
    sa.Column('move_uci', sa.String(length=10), nullable=False),
    sa.Column('fen_after', sa.String(length=100), nullable=False),
    sa.Column('time_taken', sa.Float(), nullable=True),
    sa.Column('llm_move_message', sa.Text(), nullable=False),
    sa.Column('llm_extraction_message', sa.Text(), nullable=False),
    sa.Column('model_used', sa.String(length=100), nullable=False),
    sa.ForeignKeyConstraint(['game_id'], ['games.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_game_moves_game_id_move_number', 'game_moves', ['game_id', 'move_number'], unique=True)
    op.create_index('ix_game_moves_model_used', 'game_moves', ['model_used'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index('ix_game_moves_model_used', table_name='game_moves')
    op.drop_index('ix_game_moves_game_id_move_number', table_name='game_moves')
    op.drop_table('game_moves')
    op.drop_index('ix_ratings_model_name', table_name='ratings')
    op.drop_table('ratings')
    op.drop_index('ix_games_white_model', table_name='games')
    op.drop_index('ix_games_timestamp', table_name='games')
    op.drop_index('ix_games_black_model', table_name='games')
    op.drop_table('games')
    # ### end Alembic commands ###
